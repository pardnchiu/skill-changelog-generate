---
name: changelog-generate
description: 從 git diff 輸出生成結構化的 update.md 更新日誌，並自動進行語意化版本控制。當使用者請求生成更新日誌、發布說明，或基於未提交的 git 變更更新文件時使用。
---

# 更新日誌生成器

從未提交的 git 變更自動生成 `update.md`，並進行語意化版本控制。

## 工作流程

1. 從 git 獲取最新版本標籤
2. 收集 git 狀態和完整工作區差異
3. 分類變更並決定版本升級
4. 生成結構化的 `update.md`

## 步驟 1: 版本偵測
```bash
git fetch --tags --quiet 2>/dev/null

# 獲取最新的語意化版本標籤（按版本號排序）
CURRENT_VERSION=$(git tag -l 'v[0-9]*.[0-9]*.[0-9]*' --sort=-v:refname | head -1)

if [ -z "$CURRENT_VERSION" ]; then
    CURRENT_VERSION="v0.0.0"  # 沒有標籤存在，將變成 v0.1.0
fi

echo "$CURRENT_VERSION"
```

**替代方案（包含提交距離資訊）：**
```bash
# 返回：v1.2.3（精確標籤）或 v1.2.3-5-g1a2b3c4（距離標籤 5 個提交）
git describe --tags --match 'v[0-9]*' --abbrev=0 2>/dev/null || echo "v0.0.0"
```

## 步驟 2: 收集變更

```bash
# 獲取完整工作區差異
git diff

# 獲取變更檔案摘要
git status --short
```

## 步驟 3: 分類標籤

分析工作區變更並按主要標籤分組：

| 標籤 | 範圍 | 範例 | 版本影響 |
|-----|-------|----------|----------------|
| `FEAT` | 新功能 | 新函式、端點、元件 | **MINOR** (0.X.0) |
| `FIX` | 錯誤修正 | 錯誤處理、邏輯修復、空值檢查 | PATCH (0.0.X) |
| `UPDATE` | 修改現有行為 | 參數變更、演算法調整 | PATCH |
| `ADD` | 新檔案/資源（非功能） | 設定檔、資源、依賴 | PATCH |
| `REMOVE` | 刪除 | 棄用的程式碼、未使用的檔案 | PATCH |
| `REFACTOR` | 程式碼重構（無行為變更） | 提取函式、重新命名、重組 | PATCH |
| `PERF` | 效能改善 | 快取、演算法優化 | PATCH |
| `STYLE` | 僅格式化 | 空白、程式碼規範、匯入順序 | —（無升級） |
| `DOC` | 文件 | 註解、README、文件字串 | —（無升級） |
| `TEST` | 測試相關 | 新測試、測試修復、覆蓋率 | —（無升級） |
| `CHORE` | 維護 | CI/CD、工具、版本升級 | —（無升級） |
| `SECURITY` | 安全性修補 | 漏洞修復、驗證強化 | PATCH |
| `BREAKING` | 破壞性變更 | API 簽章變更、移除 | **MAJOR** (X.0.0) |

## 步驟 4: 版本升級規則
```
CURRENT = 從現有 update.md 提取（預設：v0.0.0）

IF update.md 不存在:
    NEW = v0.1.0

ELSE:
    MAJOR_TAGS = [BREAKING]
    MINOR_TAGS = [FEAT]
    PATCH_TAGS = [SECURITY, FIX, UPDATE, ADD, REMOVE, REFACTOR, PERF]
    NO_BUMP    = [STYLE, DOC, TEST, CHORE]

    IF 存在任何 MAJOR_TAGS:
        MAJOR += 1, MINOR = 0, PATCH = 0
    ELSE IF 存在任何 MINOR_TAGS:
        MINOR += 1, PATCH = 0
    ELSE IF 存在任何 PATCH_TAGS:
        PATCH += 1
    ELSE:
        無版本變更（可選：跳過版本行或保持當前版本）
```

## 步驟 5: 輸出格式

生成 `./update.md`，中文部分在前，然後是英文部分：

```markdown
# Update Log

> Generated: $(date -u '+%Y-%m-%d %H:%M (+00:00)')
> vX.Y.Z → vA.B.C

## Recommended Commit Message

Suggested commit message based on the changes
<details>
<summary>翻譯</summary>
根據變更建議的提交訊息
</details>

***

## Summary

Brief 1-2 sentence overview of changes.
<details>
<summary>翻譯</summary>
變更的簡要說明（1-2句話）
</details>

## Changes

### FEAT
- Description of new feature

<details>
<summary>翻譯</summary>

- 新功能描述

</details>

### FIX
- Description of bug fix

<details>
<summary>翻譯</summary>

- 錯誤修正描述

</details>

### UPDATE
- Description of modification

<details>
<summary>翻譯</summary>

- 修改描述

</details>

### REFACTOR
- Description of restructure

<details>
<summary>翻譯</summary>

- 重構描述

</details>

### DOC
- Description of documentation change

<details>
<summary>翻譯</summary>

- 文件變更描述

</details>

### CHORE
- Description of maintenance task

<details>
<summary>翻譯</summary>

- 維護任務描述

</details>

***

## Files Changed

| File | Status | Tag |
|------|--------|-----|
| `path/to/file.go` | Modified | FEAT |
| `path/to/other.go` | Added | ADD |


***

Generated by [Claude Code](https://github.com/pardnchiu/skill-readme-generate)
```

## 分類規則

1. **版本優先順序**：`BREAKING` > `FEAT` > `PATCH_TAGS` > `NO_BUMP`
2. **最高者獲勝**：單一 `BREAKING` 變更 → MAJOR 升級，無論其他標籤為何
3. **空白區段**：省略沒有變更的標籤
4. **首次發布**：沒有現有 `update.md` → 總是 `v0.1.0`
5. **無功能變更**：僅 `STYLE`/`DOC`/`TEST`/`CHORE` → 保持當前版本或註記「無版本升級」
6. **群組相關變更** — 將相似的變更組合在相同標籤下
7. **範圍階層** — `BREAKING` > `SECURITY` > `FEAT` > `FIX` > 其他 > `DOC`
8. **描述格式** — 以動詞開頭：「新增」、「修復」、「更新」、「移除」、「重構」
9. **聚焦於意圖** — 描述變更了什麼以及為什麼，而非個別檔案

## 邊界情況

- **包含功能的新檔案** → `FEAT`（不是 `ADD`）
- **新功能的測試** → `TEST`（與 `FEAT` 分開）
- **重新命名 + 修改** → `REFACTOR` + `UPDATE`（兩個項目）
- **刪除棄用 + 新增替代** → `REMOVE` + `FEAT`
- **.gitignore 變更** → `CHORE`
- **go.mod/go.sum** → `CHORE`（依賴管理）
